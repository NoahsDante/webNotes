# 重构原则

## 何时重构

#### 重构（名词）

对软件内部的一种调整，目的是在**不改变软件可观察行为下的前提下，提高其可理解性，降低其修改成本**

#### 重构（动词）

使用一系列**重构手法**，在不改变软件可观察行为的前提下，**调整其结构**

#### 更容易理解和修改

在软件内部做很多修改，但必须对软件可观察的外部行为**只造成很小变化，甚至不造成变化**。并且达到性能优化

#### 不改变软件可观察的行为

任何用户，都不知道已经有**东西发生了变化**

### 两顶帽子

使用重构技术开发软件时，把自己的时间分配给两种截然不同的行为：**添加功能新功能、重构**

- 添加新功能时：**不应该修改既有的代码**，只管添加新功能，并且通过测试
- 重构：**不能添加新功能**，只管改进程序结构

## 为何重构

#### 改进软件设计

重构很像是在整理代码，让所有东西回到应处的位置上；代码结构的流失是累积性。

常常是因为代码在不同的地方使用完全相同的语句做同样的事；**消除重复代码**是优秀设计的根本。

#### 使软件更容易理解

可理解性还有另一方面：可以利用重构理解不熟悉的代码；不仅仅会看而且会真正动手去修改代码，让它更好地反映出我的理解，然后执行，是否正常运行，检验自己的理解是否正确

#### 帮助找到bug

对代码的理解，可以快速到bug

#### 提高编程速度

良好的设计是快速开发的根本 - 如果没有良好的设计，或许某一段时间内是可以迅速进展，但是恶劣的设计很快就让你慢下来，会把时间花到调试，无法添加新功能。修改时间越长，就必须花越多的时间去理解系统，寻找重复代码。

## 何时重构

**事不过三原则，三则重构**

### 添加功能

是否能对**这段代码进行重构，使我能更快地理解它。然后我就会重构**

### 修补错误时

调试过程中运用重构，多半是为了让代码更具**可读性**；让能一眼看出bug

### 复审代码

可以改善开发状况。这种活动有助于在开发团队中传播知识，也有助于让较有经验的开发者把知识传递给比较欠缺经验的人，并帮助更多人理解大型软件系统中的更多部分；

## 重构的难题

# 代码坏味道

# 重构列表

# 重新组织函数

# 重新组织数据

将一个值用于多个不同的用途，引用和值的混淆经常会造成问题，用将**引用对象改为值对象**和将**值对象改为引用对象**在**两者之间切换**

## 拆分变量



# 简化条件表达式

# 简化函数调用

# 处理概括关系

# 重构，复用与实现



# 封装



# 搬移特性

## 搬移函数

**模块化**是优秀软件设计的核心所在，好的模块化能够让我在修改程序时只**需理解程序的一小部分**；

最直接的一个动因是，它**频繁引用其他上下文中的元素**，而对自身上下文中的元素却关心甚少；搬移到某些更通用的地方

### 做法

检查函数在当前上下文里引用的所有程序元素（包括变量和函数），考虑是否需要将它们一并搬

## 移动语句

### 动机

**让存在关联的东西一起出现，可以使代码更容易理解**

## 搬移字段

### 动机

往往数据结构才是一个健壮程序的根基；搬移字段的**操作通常是在其他更大的改动背景下发生的**

## 搬移语句到函数

### 动机

我发现调用某个函数时，**总有一些相同的代码也需要每次执行**，那么我会考虑将此段代码合并到函数里头

## 搬移语句到调用者

### 动机

把**表现不同的行为从函数里挪出，并搬移到其调用处**；要差异代码被搬移到调用点

## 以函数调用取代内联代码

### 动机

善用**函数可以帮助我将相关的行为打包起来**，这对于提升代码的表达力大有裨益—— 一**个命名良好的函数，本身就能极好地解释代码的用途，使读者不必了解其细节**；函数**同样有助于消除重复，因为同一段代码我不需要编写两次，每次调用一下函数即可**



## 拆分循环

### 动机

如果你在一次循环中做了两件不同的事，那么**每当需要修改循环时，你都得同时理解这两件事情**。如果能够将循环拆分，让一个循环只做一件事情，那就能确保每次修改时你需要理解要修改的那块代码的行为就可以了

## 以管道取代循环

集合管道是这样一种技术，**它允许我使用一组运算来描述集合的迭代过程**，其中每种运算接收的入参和返回值都是一个集合

## 移除死代码

当你尝试阅读代码、理解软件的运作原理时，**无用代码确实会带来很多额外的思维负担**；一旦代码不再被使用，我们就该立马删除它。**有可能以后又会需要这段代码，但我从不担心这种情况；就算真的发生，我也可以从版本控制系统里再次它翻找出来**

# 重构API

# 处理继承关系

# 重构细节



