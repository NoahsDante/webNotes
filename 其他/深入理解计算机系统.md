## 计算机系统漫讲

### 信息就是位 + 上下文

系统中所有的信息，都是**由一串比特表示的。区分不同数据对象的唯一方法就是读到这些数据对象时的上下文。**

### 程序被其他程序翻译成不同的格式

从源程序到目标文件的转化是由编译器完成的；

由四个阶段完成

#### 预处理阶段

根据以字符#开头的命令，读取**系统文件对应需要引用的库，并把它直接插入程序文本中**。结果得到另一个c程序。通常是.i作为文件扩展名。

#### 编译阶段

包含**汇编语言程序**。每条语句都以一种文本格式描述了一条低级机器语言指令。它为不同高级语言的不同编译器提供了通用的输出语言。

#### 汇编阶段

将翻译成机器语言指令，把这些指令打包成一种可重定为目标程序的格式，并将结果保存在目标文件中。现在该文件内容是**二进制**文件。

#### 连接阶段

如果该文件中有使用其他函数；那么这些函数是每个c编译器都提供标准C库的函数。这些函数库是存在某个文件中；**所以这些文件必须以某种方式合并到目标程序中。**

### 处理器读并解读存在内存中的指令

#### 系统的硬件组成

1. 总线

> 贯穿整个系统的是一组电子管道；它**将携带信息字接并负责在各个部件间传递**。
>
> 通常总线被设计成传送定长的字节块，就是字；字中的字节数是一个基本的系统参数，如32位、64位

2. I/O设备

> 是系统与外部世界的联系通道。用户输入的键盘和鼠标，显示屏，以及用于长期存储数据和程序的磁盘驱动器。
>
> 每个I/O设备都通过一个**控制器或适配器与I/O总线相连**；其中控制器与适配器的区别；控制器是**I/O设备本身或者是系统的主印制电路板上的芯片组**；而适配器则是一块插在**主板插槽上的卡**。 

![](https://raw.githubusercontent.com/NoahsDante/webNotes/master/其他/img/1.png))

3. 主存

> 是一个临时存储设备，**在处理执行程序时，用来存放程序和程序处理的数据**。从物理来说，主存时有一组动态随机存取存储器芯片组成。从逻辑来说，存储器是一个线性的字节数组，每个字节都有其唯一的地址，这些地址是从零开始的。

5. 处理器

> 中央处理单元，简称处理器，**是解释或执行存储在主存中指令的引擎**。处理器的核心是一个大小为一个字的存储设备，称为程序计数器。

#### 存储设别形成层次结构

![](https://raw.githubusercontent.com/NoahsDante/webNotes/master/其他/img/2.png))

存储器层次结构的主要思想是上一层的存储器作为低一层存储器的高速缓存。

### 操作系统管理硬件

当执行某个程序时，都没直接方为键盘，显示屏，磁盘或者主存，取而代之的是，它们依靠操作系统提供的服务。可以把操作系统看成是应用程序和硬件之间插入的一层软件。所有应用程序对硬件的操作都必须通过操作系统。
![](https://raw.githubusercontent.com/NoahsDante/webNotes/master/其他/img/3.png)

文件是对I/O设备的抽；
虚拟内存是对主存和磁盘I/O设备的抽象；
进程是对处理器、主存和I/O设备的抽象)

#### 进程
进程是操作系统对一个正在运行的程序的一种抽象。
操作系统保存跟踪运行所需的所有状态信息，这种状态叫做上下文。

#### 线程
一个进程可以由多个称为线程的执行单元组成，每个线程都运行在进程的上下文中，并共享同样的代码和全局数据。

#### 虚拟内存
是一个抽象概念，**他为每个进程提供了一个假象，即每个进程都在独占地使用主存**。每个进程看到的内存都是一致的，称为虚拟内存。

基本思想是把一个进程虚拟内存的内容存储在磁盘上，然后用主存作为磁盘的高速缓存。

#### 文件

就是字节序列；他向应用程序提供了一个统一的视图，来看待系统中可能含有的所有各式各样的I/O设备。

## 信息的表示和处理

### 信息存储

#### 字数据的大小

 每台计算机都有一个字长，指明**指针数据的标称大小**，这是虚拟地址是以这样一个字长编码的，所以字长决定的最重要的系统参数就是虚拟地址空间大小。

#### 寻址和字节顺序

由有两种规则

1. 小端法：最低有效字节在最前面
2. 大端法：最高有效字节在最前面

#### 位级运算与逻辑运算区别

&&相当一个开关语句，就是说如果&&前面值为false那么他就不继续执行后面的表达式；而&不管前面的值为什么，总是执行其后面的语句。

&& 和 || 是boolean的逻辑运算， 返回为bool值

 &是位运算符,它会将两边的运算都计算出来,再进行与运算; &是用来处理0101这样的2进制字符的位运算的。 


  &&是布尔逻辑运算符（短路运算）,只要有一边的运算结果为false,它都会马上返回false；&&是处理true和false这样的boolean运算。

同样的道理，|| 也是布尔逻辑运算符，只要有一边的运算结果是true，它会马上返回true



## 程序的机器级表示

### 控制

#### if语句与switch语句

编译器会根据代码的实际情况，权衡时间效率和空间效率，去选择一个对当前代码而言综合效率最高的一种

##### 逐条件判断法

逐条件判断法其实就是和if……else语句的汇编实现相同，编译器把switch语句中各个case条件逐个进行判断，直到找到正确的case语句块。这种方法适用于switch语句中case条件很少的情况，即使逐个条件判断也不会导致大量时间和空间的浪费

##### 跳转表实现法

在编译器采用这种switch语句实现方式的时候，会在程序中生成一个跳转表，跳转表存放各个case语句指令块的地址，程序运行时，首先判断switch条件的值，然后把该条件值作为跳转表的偏移量去找到对应case语句的指令地址，然后执行。这种方法适用于case条件较多，但是case的值比较连续的情况，使用这种方法可以提高时间效率且不会显著降低空间效率

#### 二分查找法

如果case值较多且分布极其离散的话，如果采用逐条件判断的话，时间效率会很低，如果采用跳转表方法的话，跳转表占用的空间就会很大，前两种方法均会导致程序效率低。在这种情况下，编译器就会采用二分查找法实现switch语句，程序编译时，编译器先将所有case值排序后按照二分查找顺序写入汇编代码，在程序执行时则采二分查找的方法在各个case值中查找条件值，如果查找到则执行对应的case语句，如果最终没有查找到则执行default语句

### 过程

提供了一种封装代码的方式，用一组指定的参数和一个可选返回值实现了某种功能。

#### 运行时栈

调用机制的一个关键特性在于使用栈数据结构提供后进先出的内存管理原则。

## 处理器体系结构

## 优化程序性能

## 存储器层次结构

## 连接

## 异常控制流

### 异常

是**控制流中的突变用来响应处理器状态中的某些变化**。

## 虚拟内存

## 系统级I/O

## 网络编程

## 并发编程

