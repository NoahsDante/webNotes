## 计算机网络和因特网

### 是什么是因特网

具体构成：它是一个互联了遍及世界数十亿计算设备的网络。

服务描述：为应用程序提供服务的基础设施

### 网络边缘

### 网络核心

因特网是一个网络的网络，其结构复杂，由十多个第一层ISP和数十万个较低层ISP组成；ISP覆盖的区域多种多样；较低层的ISP与较高层的ISP相连，较高层ISP彼此互联。用户和内容提供商是是较低层ISP的客户，较低层ISP是较高层ISP的客户。

### 分组交换网中的时延、丢包和吞吐量

#### 时延类型

1. 处理时延
   - 检查分组首部和决定该分组导向何处需要的时间
2. 排队时延
   - 在队列中，当分组在链路上等待传输时，它经受排队时延
3. 传输时延
   - 路由器推出分组所需要的时间
4. 传播时延
   - 是一个比特从一台路由器传播到另一台路由器所需要的时间

#### 排队时延和丢包

##### 排队时延

取决于流量到达该队列的速率、链路的传输率和到达流量的性质；即流量是周期性还是以突发形式到达。

随着流量强度接近1，平均排队时延迅速增加。该强度的少量增加将导致时延大比例增加。

#### 丢包

由于没有大方存储这个分组，路由器将丢弃该分组，即该分组将会丢失。分组丢失的比例随着流量强度增加而增加。

### 协议层次及其服务模型

#### 分层的体系结构

简化本身由于提供模块化而具有很高价值，使某层所提供的服务实现易于改变。

只要该层对其上面的提供服务相同，并且使用来自下面层次的相同服务，当某层的实现变化时，该系统的其余部分保持不变。

#### 协议分层

##### 应用层

是网络应用程序及它们的应用层协议存留的地方。应用层协议分布在多个端系统上，而一个端系统中应用程序使用协议于与另一个端系统中的应用程序交换信息分组。成为**报文**

#### 运输层

在应用程序端点之间传送应用层报文；**两种运输协议TCP和UDP；在运输层的分组称为报文段**

#### 网络层

**数据报**

从一台主机移到另一台主机。在**因特网运输层协议向网络层递交运输层报文段和目的地址**。

包括网际协议IP；决定路由的路由选择协议，根据路由将数据从原传输到目的地。

#### 链路层

为了将分组从一个节点（主机和路由器）移动到路径上的下一个节点，网络层必须依靠该链路层的服务。**帧**

#### 物理层

将该帧中的一个个比特从一个节点移到下一个节点

#### 表现层

使通信的应用程序能够解释交换数据的含义。以及数据描述（压缩、加密）

#### 会话层

提供了数据交换的定界和同步功能

## 应用层

### 应用层协议原理

研发网络程序的核心是写出能够运行在**不同端系统**和通过**网络彼此通信的程序**

#### 网络应用程序体系

由应用程序研发者设计规定了如何在各种端系统上组织该程序，由两种主流体系结构：

1. 客户-服务器体系
   - 有一个总是打开的主机称为服务器；它服务于来自许多其他称为客户的主机请求；客户之间**不进行通信**
2. p2p体系
   - 对位于数据中心的专用服务器有最小的依赖；**应用程序在间断连接的主机之间使用通信**，这些主机对称为对等方；这些对等方并不为服务商所有，却为用户控制的桌面机和膝上机所有；不必通过专门的服务器

### web和HTTP

web的按需操作。当用户需要时，就能得到所想要的内容。

HTTP服务器并不保存关于客户的任何信息，所以**HTTP是一个无状态协议**

#### 非持续连接和持续连接

##### 非持续连接：

每个请求/响应是经一个单独的TCP连接发送；

从客户端请求HTML基本文件起到客户收到整个文件所花费时间；这涉及一次“三次握手”过程，

1. 客户向服务器发送一个小TCP报文段
2. 服务器用一个小TCP报文段做出确认和响应
3. 客户向服务器返回确认

完成三次握手的前两部分后，客户结合三次握手的第三部分（确认）**向该TCP连接发送HTML请求报文，一旦该请求报文到达服务器，服务器就在该TCP连接上发送HTML文件。因此总的响应时间就是两个返回时间加上服务器传输HTML文件的时间。**

缺点：

1. 必须为每个请求的对象建立和维护一个全新的连接。对于每个这样的连接，在客户和服务器中都要分配TCP的缓冲区和保持TCP变量，这个WEB服务器带来严重的负担
2. 每个对象经受两倍的返回时间的交付时延

持续连接：所有请求及其响应经相同的TCP连接发送

服务器在发送响应后保持该TCP连接打开，在相同的客户与服务器之间，后续的请求报文和响应报文能够通过相同的连接进行传送。

#### HTTP报文格式

##### HTTP请求格式

请求行

> 方法 URL 版本

首部行

> 

空行

实体体

##### HTTP响应格式

状态行

> 方法 URL 版本

首部行

> 

空行

实体体

#### cookie

当访问一个网站时，当浏览器收到该HTTP响应报文时，会看到set-cookie：首部。该浏览器它管理的特定cookie文件添加一行，该行包含服务器的主机名和set-cookie：首部中的识别码。当用户再次访问时，每个请求一个web页面，其浏览器就会查询该cookie文件并抽取她对这个网站的识别码，并放到HTTP请求报文中包含识别码的cookie首部：cookie；

可以看到cookie可以用于标示一个用户。因此cookie可以在无状态的HTTP之上建立一个用户会话层。

#### Web缓存

Web缓存器，也叫代理服务器，它时能代表初始Web服务器来满足HTTP请求的网络实体。Web缓存器有自己磁盘存储空间，并在存储空间中保存最近请求的对象副本。

**优点：**

1. Web缓存器可以大大减少对客户请求的响应时间，特别是当客户与初始服务器之间的瓶颈带宽远低于客户与Web缓存器之间的瓶颈带宽时更是如此。
2. 大大减少一个机构的接入链路到因特网的通信量。通过减少通信量，该机构不必急于增加宽带，因此降低费用。

#### 条件GET方法

怎样更新缓存的旧的数据；

该缓存器通过发送一个条件GET执行最新检查。

> If-modified-since:web,9 sep 2019 09:23:24

注意的是If-modified-since:首部行的值正好等于一个星期前服务器发送的响应报文中last-modified:首部行的值。该条GET报文告诉服务器，仅当自指定日期之后该对象被修改过，才发送该对象。

### DNS:因特网的目录服务

因为主机名可能有不定长的字母数字组成，路由器难以处理。提供可以便于记忆的名字；

需有有一种能进行主机名到IP地址转换的目录服务。这就是域名系统（DNS）：

1. 一个由分层的DNS服务器实现**分布式数据库**
2. 一个使得主机能够查询**分布式数据库的应用层**

##### 分布式、层次数据库

为处理扩展性问题，DNS使用量大量的DNS服务器，它们以层次方式组织，并且分布在全球范围内。有3类型的DNS服务器：**根DNS服务器、顶级域DNS服务器和权威DNS服务器**

还有另一类重要的DNS服务器，称为**本地DNS服务器**；当主机发出DNS请求时，该请求被发往本地DNS服务器，它起着代理的作用，并将该请求转发到DNS服务器层次结构中。

**递归查询**：该查询以自己的名义请求，来获得对应域名的ip；

**迭代查询**：所有回答都是直接返回给本地服务器。

通常：请求主机到本地DNS服务器的查询时递归查询，其余的查询是迭代；

### 视频流和内容分发网

视频是一系列的图像，通常以一种恒定的速率来展现。视频的一个重要特征是它能够被压缩，因而可用恒定比特率来权衡视频质量。比特率越高，图像质量越好，用户的总体视觉感受越好。

#### HTTP流和DASH

每个文件有一个特定的URL，当用户要看该视频时，客户与服务器创建一个TCP连接并发送对该URL的HTTPGET请求。服务器则以底层网络协议和流量条件允许的尽可能快的速率，在一个HTTP响应报文中发送该视频文件。在客户一侧，字节被收集袋客户应用的缓存中。一旦该缓存中的字节数量超过预先设定的门限吗，客户啊应用程序就开始播放。流式视频应用程序周期性地客户应用程序缓存中抓取帧，对这些帧解压缩并且在用户屏幕上展现；因此，流式视频应用接收到视频就进行播放，同时缓存该视频后部分的帧。

但有严重的缺陷，即所有客户接受到相同编码的视频，不同带宽大小都会接受相同流的研发。

所有就研发出**HTTP动态适应性流**

#### 内容分发

其中最简单的方式就是：**建立单一的大规模数据中心；但是会有问题**

1. 如果客户远离数据中心，服务器到客户的分组将跨越许多通信链路并很可能通过许多ISP，会给用户带来停滞时延；出现这种事件的可能性随着端到端路径中链路数量的增加而增加。
2. 流行的视频很可能经过相同的通信链路发送许多次，浪费了网络宽带；支付费用
3.  单一个数据中心代表一个单点故障，就将不能够分发任何视频流了

为了解决上述问题；可利用内容分发网（CDN）；CDN管理分布在多个地理位置上的服务器，在它的服务器中存储视频副本，并且所有试图将每个用户请求定向到一个将提供最好的用户体验的CDN位置。

#### 集群选择策略

核心就是**集群选择策略**，即动态将客户定向到CDN中的某个服务器集群或数据中心机制。

### 套接字编程：生成网络应用

#### UDP 套接字编程

用户数据报协议 (UDP) 是一种无连接的传输协议，因而不可靠。它很少执行错误检查，不向 IP 服务添加任何内容，除了提供进程到进程的通信（而不是主机到主机通信）

UDP是无连接不可靠的数据报协议，不同于TCP提供的面向连接的可靠字节流。**从资源的角度来看，相对来说UDP套接字开销较小，因为不需要维持网络连接**，而且因为无需花费时间来连接连接，所以**UDP套接字的速度也较快**。

#### TCP套接字编程

传输控制协议 (TCP) 是一个可靠而复杂的传输层协议。 TCP 向 IP 添加面向连接的功能和可靠性

TCP 是一个可靠的流传递服务，**其保证在不重复也不丢失数据的情况下从一台主机发送到另一个主机的数据流传输**。由于包传输不可靠，因此可使用一种称之为“肯定应答重传”的技术来保证包传输的可靠性。此基础技术需要接收方在其收到数据时以确认消息进行响应。

发件人保留所发送的每个包的记录，并等待确认之后，您才能发送下一个包。发件人还从发送包时开始计时，如果计时器到期，就重新传输包。在包丢失或损坏时，需要计时器

## 运输层

是运行在不同主机上的应用进程提供直接的通信服务

### 运输层服务

运输层协议在为运行在不同主机上的应用进程之间提供了逻辑通信功能；

#### 运输层与网络层的区别

运输层：**为运行在不同主机上的进程之间提供逻辑通信的能力；**

网络层：**提供了主机之间的逻辑通信**

#### 因特网运输层概述

因特网网络层协议叫做“IP”；全称是网际协议；IP为主机之间提供了逻辑通信。IP的服务模型是**尽力而交付服务**；这意味着**IP尽它最大努力在通信的主机之间交付报文段**，**但它并不做任何确保。**

### 多路复用与多路分解

多路分解：将运输层报文段中的**数据交付到正确的套接字**的工作；

多路复用：从源主机的**不同套接字中收集数据块**、并为每个数据快**封装上首部信息从而生成报文段**，然后将报文段传递到网络层的工作

##### 运输层多路复用

1. 套接字的唯一标识符
2. 每个报文段特殊字段来指示该报文段所要交付的套接字；这些特殊字段**源端口号字段**和**目的端口字段**

##### 运输层多路分解

主机上的每个套接字被分配一个端口号，当报文段到达主机时，运输层检查套接字被分配一端口号，当报文段到达主机时，运输层检查报文段中的目的端口号，并将其定向到相应的套接字。然后报文段中的数据通过套接字进入其所连接的进程。

TCP套接字是由一个四元组（**源IP地址，源端口号，目的IP地址，目的端口号**）来标识的。

服务器主机可同时支持很多TCP套接字，每个套接字与一个进程相联系，并由其四元组来标识每个套接字。当一个**TCP报文段到达主机时，所有4个字段（源IP地址，源端口号，目的IP地址，目的端口号）用来定向（多路分解）报文段到相应的套接字。**

### 无连接运输：UDP

使用UDP时，在发送报文段前，发送方和接收方的**运输层实体之间没有进行握手**。**UDP无连接**

#### 特点

1. 应用层能更好地控制要发送的数据和发送时间
2. 无需连接建立
3. 无连接状态
4. 分组首部开销小：每个TCP报文段都有20字节的首部开销，而UDP仅有8字节的开销。

应用：如因特网电话，实时视频会议、流式存储音频与视频。这些应用都能容忍少量的分组丢失，

##### UPD检验和

检验和用于**确定当UDP报文段从源到达目的时，其中的比特是否发生了改变**；

在接收方，全部的4个16比特字一起相加。如果分组中无差错，则显然在接收方这个和111111111111。如果时有1个比特0，就知道分组中出现了差错。

### 可靠数据传输原理

###### 具有比特差错信道上的可靠数据传输

控制报文使得接收方可以让发送方知道那些内容被正确接收，那些内容接收有误从需要重传。基于这种重传机制的可靠数据传输协议称为“**自动重传请求**”协议。

其中需要另外三种协议来处理存在的比特差错

1. 差错检测
   - 需要一种机制以使接收方检测到何时出现了比特差错
2. 接收方反馈
   - 发送方要了解接收方的情况；唯一的途径就是让接收方提供明确的反馈信息给发送方
3. 重传
   - 接收方收到有差错的分组时，发送方将重传该分组

### 面向连接的运输TCP

TCP是面向连接的，这是因为在一个应用进程可以开始向另一个应用进程发送数据之前，这个两个进程必须先相互“握手”，即它们必须相互发送某些预备报文段，以建立确保数据传输所需参数。**同时也提供全双工服务**：如果一台主机的进程A与另一台主机上的进程B存在一条TCP连接，那么应用层数据就可**在进程B流向进程A的同时，也从进程A流向进程B。TCP连接也总是点对点的，即在单个发送发与单个接收方之间的连接。**

## 计算机网络中的安全

### 什么是网络安全

#### 安全通信具有下列的特性

1. 机密性：仅有**发送发和希望的接收方能够理解传输的报文内容**。因为窃听者可以截获报文，这必须要求报文在一定程度上进行加密，以便截获者不能解密截取到的报文。
2. 报文完整性：发送方和接收方**可以相互鉴别对方**，还需要确保其通信的内容在**传输过程中未被改变，恶意篡改或者意外改动。**
3. 端点鉴别：发送方和接收方都应该能证实通信过程所涉及的另一方，以确信通信的另一方确实具有他们所声称的身份。
4. 运行安全

### 密码学的原则

#### 对称密钥密码学

#### 公开密钥加密

### 报文完整性

### 鉴别

### 使TCP连接安全：ssl

### 运行安全性：防火墙和入侵检测系统





