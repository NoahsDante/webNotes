# 浅谈前端测试

## 前端单元测试是什么

为检测特定的目标是否符合标准而采用专用的工具或者方法进行验证,并最终得出特定的结果;或者是一个单元测试是用于判断某个特定条件(或者场景)下某个特定函数的行为

## 测试分类

### 单元测试

### 集成测试

### 端到端测试

## 单元测试

### 为什么需要单元测试

1. QA不断反馈代码用BUG
2. 代码出现BUG,叠加代码修复BUG
3. 已经开发完成一个模块,但没有页面提供调试测试;

### 如何写单元测试

#### 原则

测试代码时,只考虑测试,不考虑内部实现

数据尽量模拟现实,越靠近现实越好

充分考虑数据的边界条件

对重复、复杂、核心代码、重点测试

测试、功能开发结合,有利于设计和代码重构

### 测试方案

- 基于

  JSDOM

  - **优点**：快，执行速度最快，因为不需要浏览器启动
  - **缺点**：无法测试如seesion或cookie等相关操作，并且由于不是真实浏览器环境因此无法保证一些如Dom相关和BOM相关的操作的正确性，并且JSDOM未实现localStorage，如果需要进行覆盖，只能使用第三方库如[node-localStorage](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Flmaccherone%2Fnode-localstorage) （这个库本身对与执行环境的判断有一些问题）进行模拟。

- 基于

  PhantomJs

  等无头浏览器

  - **优点**: 相对较快，并且具有真实的DOM环境
  - **缺点**: 同样不在真实浏览器中运行，难以调试，并且项目issue非常多，puppeteer发布后作者宣布不再维护

- 使用Karma或puppeteer等工具，调用真实的浏览器环境进行测试

  - **优点**：配置简单，能在真实的浏览器中运行测试，并且karma能将测试代码在多个浏览器中运行,同时方便调试
  - **缺点**: 唯一的缺点就是相对前两者运行稍慢，但是在单元测试可接受范围内

### 测试框架和相关工具

- 测试平台
  - [karma](https://link.juejin.im/?target=https%3A%2F%2Fkarma-runner.github.io%2F2.0%2Findex.html) – Google Angular团队开发的测试运行平台，配置简单灵活，能够很方便将测试在多个真实浏览器中运行。

- 测试框架
  - [mocha](https://link.juejin.im/?target=https%3A%2F%2Fmochajs.org%2F) – Tj大神开发的很优秀的测试框架，有完善的生态系统，简单的测试组织方式，不对断言库和工具做任何限制，非常灵活。
  - [jasmine](https://link.juejin.im/?target=https%3A%2F%2Fjasmine.github.io%2F) – 和Mocha语法非常相似，最大的差别是提供了自建的断言和Spy和Stub
  - [jest](https://link.juejin.im/?target=https%3A%2F%2Ffacebook.github.io%2Fjest%2F) – facebook出品的大而全的测试框架，React官方推荐的单元测试框架，配置简单运行速度快。（备注：无法和Karma进行集成）
  - [AVA](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Favajs%2Fava) – 和上面的测试框架最大的区别在于多线程，运行速度更快。
  - 其他 – 还有一些其他的前端测试框架，但是相似度比较高，无非是对断言和测试桩等工具的集成度不同，如果考虑稳定以及成熟度建议选择Mocha，对测试运行速度有非常高的要求可以考虑jest和AVA
- 测试辅助工具
  - 断言库 – [Chai](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fchaijs%2Fchai) 如果单元测试不跑在真实的浏览器环境中，可以简单使用node的assert，但是建议使用Chai作为断言库（提供了TDD和BDD风格多种断言方式，并且生态系统繁荣）。
  - 测试桩（又称为测试替身） – [Sinon](https://link.juejin.im/?target=http%3A%2F%2Fsinonjs.org%2F)、[testDouble](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Ftestdouble%2Ftestdouble.js%2F)等工具提供了如测试桩、拦截模拟请求、”时间旅行“等功能，主要用于解决”函数不纯”（比如测试回调是否被正确调用，XHR是否正确发起请求，时间延迟后函数行为是否正确）的测试问题。
- 测试覆盖率工具
  - [istanbul](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fgotwarlost%2Fistanbul) istanbul的基础实现，提供了命令行等工具，但是无法解决代码编译打点的问题
  - [istanbul-instrumenter-loader](https://link.juejin.im/?target=https%3A%2F%2Fgithub.com%2Fwebpack-contrib%2Fistanbul-instrumenter-loader) istanbul的Webpack插件，能解决代码编译打点和测试报告输出的问题

### 测试方法论

#### TDD(Test-driven-development)测试驱动开发

其基**本思路是通过测试来推动整个开发进行**;测试优先编写代码

单元测试的首要目的**不是为了能够编写出大量覆盖率的全部通过的测试代码,**而是需要从使用者(调用者)的角度出发,尝试函数逻辑的各种可能性

测试不是手段是目的.测试主要**目的不是证明代码正确,而是帮助发现错误**

##### 过程

红灯(代码还不完善,测试挂)-绿灯(编写代码,测试通过) -重构(优化代码并保证测试通过)

需求分析，思考实现



#### BDD(Behavior-driven development)行为驱动开发

设计测试用例的时候对系统进行定义,倡导使用通用的语言将系统行为描述出来,将系统设计和测试用例结合起来

1. 从业务的角度定义具体的，以及可衡量的目标
2. 找到一种可以达到设定目标的、对业务最重要的那些功能的方法
3. 然后像故事一样描述出一个个具体可执行的行为。其描述方法基于一些通用词汇，这些词汇具有准确无误的表达能力和一致的含义。例如，`expect`, `should`, `assert`
4. 寻找合适语言及方法，对行为进行实现
5. 测试人员检验产品运行结果是否符合预期行为。最大程度的交付出符合用户期望的产品，避免表达不一致带来的问题

## react测试



## 参考

###### [react-jest测试](<https://www.robinwieruch.de/react-testing-tutorial/#react-mocha-chai-test-setup>)


